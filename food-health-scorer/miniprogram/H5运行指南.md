# 食品健康评分小程序 - H5平台运行指南

本文档提供在HBuilderX中将小程序项目运行到H5平台（浏览器）的详细步骤。

## 前置条件

1. 已安装最新版本的HBuilderX
2. 项目结构完整，包含所有必要的配置文件

## 运行步骤

### 方法一：使用HBuilderX内置浏览器运行

1. 在HBuilderX中打开项目文件夹 `/food-health-scorer/miniprogram`
2. 点击顶部菜单栏的"运行" -> "运行到浏览器" -> "Chrome"
3. 等待编译完成，HBuilderX将自动打开Chrome浏览器并加载应用

### 方法二：使用HBuilderX命令行工具运行

1. 打开HBuilderX，选择项目根目录
2. 点击菜单栏的“工具” -> “命令行”，打开命令行窗口
3. 在命令行中输入：
   ```bash
   # 进入项目目录
   cd miniprogram
   
   # 执行编译命令
   npm run dev:h5
   ```
   
   > 注意：如果提示找不到uni命令，请使用HBuilderX的“运行”菜单直接运行到浏览器

4. 打开浏览器访问：`http://localhost:8080`

### 方法三：使用Vite直接运行（适用于开发调试）

1. 打开终端，进入项目目录：
   ```bash
   cd /path/to/food-health-scorer/miniprogram
   ```

2. 安装Vite：
   ```bash
   npm install -D vite
   ```

3. 运行Vite开发服务器：
   ```bash
   npx vite --config vite.config.js
   ```

4. 打开浏览器访问：`http://localhost:8080`

## 注意事项

1. **API调用差异**：H5环境与小程序环境的API调用可能存在差异，特别是涉及到摄像头、文件系统等原生功能时。

2. **跨域问题**：如果后端API与前端不在同一域名下，可能会遇到跨域问题，需要在后端添加CORS支持。

3. **调试工具**：可以使用Chrome开发者工具进行调试，查看网络请求、控制台输出等。

4. **图片资源**：确保所有图片资源路径正确，H5环境下资源路径与小程序可能有所不同。

5. **环境判断**：如果需要针对不同平台做特殊处理，可以使用`uni.getSystemInfoSync().platform`进行平台判断。

## 常见问题排查

1. **白屏问题**：如果在HBuilderX中运行到Chrome浏览器时出现白屏，请尝试以下解决方法：

   - **方法1：使用新增的调试命令**
     ```bash
     npm run dev:h5-debug
     ```
     此命令使用Vite直接启动服务，可以在控制台看到详细错误信息

   - **方法2：检查路径别名配置**
     确保`vite.config.js`中的路径别名配置正确：
     ```js
     resolve: {
       alias: {
         '@': resolve(__dirname, './')
       }
     }
     ```

   - **方法3：检查index.html**
     确保index.html中包含正确的脚本引用：
     ```html
     <script type="module" src="/main.js"></script>
     ```

   - **方法4：使用Chrome开发者工具**
     打开Chrome开发者工具(F12)，查看Console面板中的错误信息

2. **CSS加载错误**：如果出现类似 `http://localhost:8080/%3C%=%20BASE_URL%20%%3Estatic/index.%3C%=%20VUE_APP_INDEX_CSS_HASH%20%%3E.css` 的错误，说明模板变量没有正确处理。解决方法：
   - 在 `index.html` 中将外部CSS引用改为内联样式
   - 或使用相对路径直接引用CSS文件
   - 如果使用Vite，确保 `vite.config.js` 中正确配置了 `publicDir` 和 `build.assetsDir`

3. **API调用失败**：确认是否使用了仅限于小程序的API，可以通过条件编译进行平台区分：
   ```js
   // #ifdef H5
   // H5平台特有代码
   // #endif
   
   // #ifdef MP-WEIXIN
   // 微信小程序特有代码
   // #endif
   ```

4. **样式异常**：H5环境下的样式渲染可能与小程序有差异，检查是否使用了特定于小程序的样式。

## 部署H5版本

完成开发后，可以使用以下命令构建H5版本用于生产环境：

```bash
npm run build:h5
```

构建完成后，`dist/build/h5` 目录下的文件可以部署到任何Web服务器。
